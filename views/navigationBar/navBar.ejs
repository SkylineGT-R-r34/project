<%
  const resolvedRole = typeof role !== 'undefined' ? role : (user && user.role);
  const isAuthenticated = Boolean(user) || Boolean(resolvedRole);
  const navLinks = [
    { label: 'Home', href: '/', match: '/' },
    { label: 'Dashboard', href: '/dashboard', match: '/dashboard' },
    { label: 'Events', href: '/events/event', match: '/events' },
    { label: 'Mood', href: '/moodTracking/moodTrackingPage', match: '/moodTracking' },
    { label: 'Social', href: '/social', match: '/social' }
  ];
  const rawCurrentPath =
    typeof currentPath !== 'undefined'
      ? currentPath
      : typeof locals !== 'undefined' && locals.currentPath
      ? locals.currentPath
      : '';
  const activePath = rawCurrentPath || '/';
%>
<header class="site-header">
  <div class="site-header__inner">
    <a href="/" class="site-brand">CampusWell</a>
    <nav class="site-nav" aria-label="Primary navigation">
      <% navLinks.forEach(link => {
        const isActive =
          activePath === link.match ||
          activePath === link.href ||
          (link.match !== '/' && activePath.startsWith(link.match));
      %>
        <a
          href="<%= link.href %>"
          data-nav-match="<%= link.match %>"
          data-path="<%= link.href %>"
          class="nav-link<%= isActive ? ' active' : '' %>"
          <%= isActive ? 'aria-current="page"' : '' %>
        >
          <%= link.label %>
        </a>
      <% }) %>
      <% if (!isAuthenticated) { %>
        <% const loginActive = activePath === '/auth/login'; %>
        <% const registerActive = activePath === '/auth/register'; %>
        <a
          href="/auth/login"
          data-nav-match="/auth/login"
          data-path="/auth/login"
          class="nav-link<%= loginActive ? ' active' : '' %>"
          <%= loginActive ? 'aria-current="page"' : '' %>
        >
          Login
        </a>
        <a
          href="/auth/register"
          data-nav-match="/auth/register"
          data-path="/auth/register"
          class="nav-link<%= registerActive ? ' active' : '' %>"
          <%= registerActive ? 'aria-current="page"' : '' %>
        >
          Register
        </a>
      <% } else { %>
        <span class="nav-link nav-link--static">
          Hi, <%= (user && (user.full_name || user.name)) || resolvedRole || 'Guest' %>
        </span>
        <a href="/logout" class="nav-link" data-nav-match="/logout" data-path="/logout">Logout</a>
      <% } %>
    </nav>
  </div>
</header>
