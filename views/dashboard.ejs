<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title || 'Dashboard' %></title>
  <link rel="stylesheet" href="/stylesheets/style.css"/>
</head>
<body data-page="Dashboard">
  <%- include('navigationBar/navBar') %>

  <div class="main-content">
    <!-- Title / hero (same pattern as other pages) -->
    <div class="picture">
      <h1>Dashboard</h1>
      <% if (user && user.full_name) { %>
        <p>Welcome back, <strong><%= user.full_name %></strong></p>
      <% } %>
    </div>

    <!-- Simple controls (reuse Events search-container style) -->
    <div class="search-container">
      <input type="text" id="dashSearch" placeholder="Search (events or moods)"/>
      <select id="dashRange">
        <option value="7">Last 7 days</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
      </select>
      <select id="dashJump">
        <option value="">Jump to‚Ä¶</option>
        <option value="#stats">Stats</option>
        <option value="#upcoming">Upcoming Events</option>
        <option value="#moods">Recent Moods</option>
        <option value="#shortcuts">Shortcuts</option>
      </select>
      <button id="dashBtn">Go</button>
    </div>

    <!-- Quick stats -->
    <div id="stats" class="events-container">
      <ul id="statsList" class="tile-list">
        <li class="tile">
          <div class="tile-title">üóìÔ∏è Upcoming events</div>
          <div class="tile-subtitle">
            <%= (stats && Number.isFinite(stats.upcomingEventsCount)) ? stats.upcomingEventsCount : 0 %> scheduled
          </div>
          <a class="tile-link" href="/events">Open Events</a>
        </li>
        <li class="tile">
          <div class="tile-title">üôÇ Mood streak</div>
          <div class="tile-subtitle">
            <%= (stats && Number.isFinite(stats.moodStreakDays)) ? stats.moodStreakDays : 0 %> days
          </div>
          <a class="tile-link" href="/mood">Open Mood</a>
        </li>
        <li class="tile">
          <div class="tile-title">ü§ù Connections</div>
          <div class="tile-subtitle">
            <%= (stats && Number.isFinite(stats.connectionsCount)) ? stats.connectionsCount : 0 %> people
          </div>
          <a class="tile-link" href="/social">Open Social</a>
        </li>
      </ul>
    </div>

    <!-- Upcoming Events -->
    <div id="upcoming" class="events-container">
      <h2>Upcoming Events</h2>
      <ul id="dashboardEventList">
        <% if (recentEvents && recentEvents.length) { %>
          <% recentEvents.forEach(function(ev){ %>
            <li class="event-item">
              <div class="event-title"><%= ev.title %></div>
              <div class="event-meta">
                <span><%= ev.location || 'TBA' %></span>
                <span>‚Ä¢</span>
                <span><%= new Date(ev.date).toLocaleDateString() %></span>
              </div>
              <a class="event-link" href="/events">Details</a>
            </li>
          <% }) %>
        <% } else { %>
          <li class="event-item empty">No upcoming events. <a href="/events">Create one</a>.</li>
        <% } %>
      </ul>
    </div>

    <!-- Recent Moods -->
    <div id="moods" class="events-container">
      <h2>Recent Moods</h2>
      <ul id="dashboardMoodList">
        <% if (recentMoods && recentMoods.length) { %>
          <% recentMoods.forEach(function(m){ %>
            <li class="mood-item">
              <span class="mood-emoji" aria-hidden="true"><%= (m.score >= 4 ? "üòÑ" : m.score >= 2 ? "üòê" : "üòî") %></span>
              <span class="mood-score">Score: <%= m.score %></span>
              <span class="mood-date"><%= new Date(m.created_at || m.date).toLocaleDateString() %></span>
              <% if (m.notes) { %><span class="mood-notes">‚Ä¢ <%= m.notes %></span><% } %>
            </li>
          <% }) %>
        <% } else { %>
          <li class="mood-item empty">No mood logs yet. <a href="/mood">Log today‚Äôs mood</a>.</li>
        <% } %>
      </ul>
    </div>

    <!-- Shortcuts -->
    <div id="shortcuts" class="events-container">
      <h2>Shortcuts</h2>
      <ul class="tile-list">
        <li class="tile"><a class="tile-link" href="/events"> New Event</a></li>
        <li class="tile"><a class="tile-link" href="/mood"> Log Mood</a></li>
        <li class="tile"><a class="tile-link" href="/social"> Find People</a></li>
      </ul>
    </div>
  </div>

  <script src="/Script.js"></script>
  <script>
    // Minimal behavior to match other pages and keep things useful
    (function () {
      const q   = document.getElementById('dashSearch');
      const btn = document.getElementById('dashBtn');
      const rng = document.getElementById('dashRange');
      const jmp = document.getElementById('dashJump');

      function doFilter() {
        const term = (q?.value || '').toLowerCase().trim();
        ['dashboardEventList','dashboardMoodList'].forEach(id => {
          const ul = document.getElementById(id);
          if (!ul) return;
          [...ul.querySelectorAll('li')].forEach(li => {
            const text = li.textContent.toLowerCase();
            li.style.display = term && !text.includes(term) ? 'none' : '';
          });
        });
      }

      btn && btn.addEventListener('click', doFilter);
      q && q.addEventListener('keyup', e => { if (e.key === 'Enter') doFilter(); });
      jmp && jmp.addEventListener('change', function(){ if (this.value) location.hash = this.value; });
      rng && rng.addEventListener('change', function(){
        // Optional: wire to server range if you have it:
        // location.href = '/dashboard?range=' + encodeURIComponent(this.value);
      });
    })();
  </script>
</body>
</html>
